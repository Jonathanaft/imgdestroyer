<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>STICKMAN VS DIGITAL MONSTER</title>
<style>
body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: black;
    color: white;
    font-family: monospace;
}

#mainCanvas {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 0;
}

#stickmanCanvas {
    position: absolute;
    z-index: 2;
}

.controls {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 3;
    background: rgba(150,0,0,0.8);
    padding: 10px;
    border: 2px solid red;
    color: white;
}

.controls * {
    margin: 2px;
}

.corruptText {
    position: absolute;
    top: 50px;
    left: 50px;
    font-size: 36px;
    font-weight: bold;
    z-index: 3;
    white-space: pre;
}
</style>
</head>
<body>

<div class="controls">
    <input type="file" id="upload" accept="image/*"><br>
    <label>Severity:</label><input type="range" id="severity" min="1" max="100" value="40"><br>
    <label><input type="checkbox" id="chaos"> TOTAL CHAOS</label><br>
    <button onclick="startChaos()">DESTROY & FIGHT</button>
    <button onclick="resetGame()">RESET</button>
</div>

<div class="corruptText" id="corruptText">STICKMAN VS DIGITAL MONSTER</div>

<canvas id="mainCanvas"></canvas>
<canvas id="stickmanCanvas" width="20" height="40"></canvas>

<script>
const mainCanvas = document.getElementById("mainCanvas");
const ctx = mainCanvas.getContext("2d");
mainCanvas.width = window.innerWidth;
mainCanvas.height = window.innerHeight;

const stickmanCanvas = document.getElementById("stickmanCanvas");
const stickCtx = stickmanCanvas.getContext("2d");

const corruptText = document.getElementById("corruptText");

let img = new Image();
let imgData = null;
let fragments = [];
let stickX = 50;
let stickY = window.innerHeight - 50;
let stickSpeed = 4;
let chaosInterval = null;

document.getElementById("upload").addEventListener("change", e=>{
    const reader = new FileReader();
    reader.onload = ()=>{img.src=reader.result;};
    reader.readAsDataURL(e.target.files[0]);
});

img.onload = ()=>{
    const tempCanvas = document.createElement("canvas");
    tempCanvas.width = img.width;
    tempCanvas.height = img.height;
    const tempCtx = tempCanvas.getContext("2d");
    tempCtx.drawImage(img,0,0);
    imgData = tempCtx.getImageData(0,0,img.width,img.height);
    createFragments();
};

// --- Fragment creation ---
function createFragments(){
    fragments = [];
    const w = img.width;
    const h = img.height;
    const fragSize = 30;
    for(let y=0;y<h;y+=fragSize){
        for(let x=0;x<w;x+=fragSize){
            const fragment = {
                x: Math.random()*window.innerWidth,
                y: Math.random()*window.innerHeight,
                w: fragSize,
                h: fragSize,
                dx: (Math.random()-0.5)*3,
                dy: (Math.random()-0.5)*3,
                imgX: x,
                imgY: y
            };
            fragments.push(fragment);
        }
    }
}

// --- Stickman ---
function drawStickman(){
    stickCtx.clearRect(0,0,stickmanCanvas.width,stickmanCanvas.height);
    stickCtx.strokeStyle = "yellow";
    stickCtx.lineWidth = 2;
    // head
    stickCtx.beginPath();
    stickCtx.arc(10,5,5,0,Math.PI*2);
    stickCtx.stroke();
    // body
    stickCtx.beginPath();
    stickCtx.moveTo(10,10);
    stickCtx.lineTo(10,25);
    stickCtx.stroke();
    // arms
    stickCtx.beginPath();
    stickCtx.moveTo(10,15);
    stickCtx.lineTo(0,20);
    stickCtx.moveTo(10,15);
    stickCtx.lineTo(20,20);
    stickCtx.stroke();
    // legs
    stickCtx.beginPath();
    stickCtx.moveTo(10,25);
    stickCtx.lineTo(0,35);
    stickCtx.moveTo(10,25);
    stickCtx.lineTo(20,35);
    stickCtx.stroke();
    stickmanCanvas.style.left = stickX + "px";
    stickmanCanvas.style.top = stickY + "px";
}

// --- Chaos & Game Loop ---
function startChaos(){
    if(chaosInterval) clearInterval(chaosInterval);
    chaosInterval = setInterval(gameLoop, 50);
}

function resetGame(){
    if(chaosInterval) clearInterval(chaosInterval);
    chaosInterval=null;
    ctx.clearRect(0,0,mainCanvas.width,mainCanvas.height);
    stickX = 50;
    stickY = window.innerHeight - 50;
    drawStickman();
    corruptText.textContent = "STICKMAN VS DIGITAL MONSTER";
}

// --- Game Loop ---
function gameLoop(){
    // move fragments
    ctx.clearRect(0,0,mainCanvas.width,mainCanvas.height);
    fragments.forEach(f=>{
        f.x += f.dx;
        f.y += f.dy;
        // bounce
        if(f.x<0||f.x+f.w>window.innerWidth) f.dx*=-1;
        if(f.y<0||f.y+f.h>window.innerHeight) f.dy*=-1;
        // draw fragment
        if(imgData){
            ctx.putImageData(
                getFragment(imgData,f.imgX,f.imgY,f.w,f.h),
                f.x,f.y
            );
        }
        // collision with stickman
        if(stickX< f.x+f.w && stickX+20>f.x && stickY< f.y+f.h && stickY+40>f.y){
            // bounce back
            stickX -= stickSpeed;
            stickY -= stickSpeed;
        }
    });

    // move stickman randomly (simulate player escaping)
    stickX += (Math.random()-0.5)*stickSpeed;
    stickY += (Math.random()-0.5)*stickSpeed;
    stickX = Math.max(0,Math.min(window.innerWidth-20,stickX));
    stickY = Math.max(0,Math.min(window.innerHeight-40,stickY));

    drawStickman();

    // corrupt text
    corruptText.textContent = randomCorruptText("STICKMAN VS DIGITAL MONSTER");
    corruptText.style.left = Math.random()*(window.innerWidth-400) + "px";
    corruptText.style.top = Math.random()*(window.innerHeight-50) + "px";
    corruptText.style.color = `rgb(${Math.random()*255},${Math.random()*255},${Math.random()*255})`;
}

function randomCorruptText(str){
    return str.split("").map(c=>{
        if(Math.random()<0.3) return String.fromCharCode(33+Math.floor(Math.random()*94));
        return c;
    }).join("");
}

function getFragment(imgData,x,y,w,h){
    const temp = new ImageData(w,h);
    for(let j=0;j<h;j++){
        for(let i=0;i<w;i++){
            const idx = (j*w+i)*4;
            const srcIdx = ((y+j)*imgData.width + (x+i))*4;
            temp.data[idx] = imgData.data[srcIdx];
            temp.data[idx+1] = imgData.data[srcIdx+1];
            temp.data[idx+2] = imgData.data[srcIdx+2];
            temp.data[idx+3] = 255;
        }
    }
    return temp;
}

// initialize stickman
drawStickman();
</script>

</body>
</html>
